<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">


<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>OSCAL</title>
    <meta name="description" content="">
    <meta name="keywords" content="">


</head>

<body class="en">
    <style>
        #pills-profile .airbuds5Pro_spesc,
        .oscal-specification-table {
            width: 80%;
            max-width: 1200px;
            padding: 100px 0;
            position: relative;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .spesc-img-left {
            width: 40%;
            height: 510px;
        }

        /* 图片未加载时显示 */
        .spesc-img-left img.image-active.on {
            background-image: url('https://www.oscal.hk/img/loading.gif');
            background-size: 20%;
            background-position: center;
            background-repeat: no-repeat;
        }

        @-webkit-keyframes fadeIn {
            0% {
                opacity: 0;
                /*初始状态 透明度为0*/
            }

            100% {
                opacity: 1;
                /*结尾状态 透明度为1*/
            }
        }

        /* 切换颜色后对应产品图片的切换渐变效果 */
        .spesc-img-left img.image-active {
            opacity: 1;
            display: block;
            -webkit-animation-name: fadeIn;
            /*动画名称*/
            -webkit-animation-duration: 1s;
            /*动画持续时间*/
            -webkit-animation-iteration-count: 1;
            /*动画次数*/
        }

        .spesc-img-left img {
            max-width: 400px;
            width: 100%;
            opacity: 0;
            margin: 0 auto;
            display: none;
        }

        .spesc-img-right {
            width: 60%;
        }

        .spesc-img-right .spesc-img-right-ul {
            font-size: 0;
        }

        .spesc-img-right .spesc-img-right-ul .spesc-img-right-ul-li {
            position: relative;
            display: inline-block;
            width: 20%;
            text-align: center;
        }

        .spesc-img-right .spesc-img-right-ul .spesc-img-right-ul-li .spescColor {
            display: inline-block;
            position: relative;
            cursor: pointer;
            width: 49px;
            height: 49px;
            border-radius: 50%;
        }

        .spesc-img-right .spesc-img-right-ul .spesc-img-right-ul-li .spescColorName {
            font-size: 20px;
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
    <div id="AMain" class="main">
        <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
            <div class="airbuds5Pro_spesc">
                <div class="spesc-img-left">
                    <img class="lazyload image-active on"
                        data-src="https://d2kbvjszk9d5ln.cloudfront.net/yshop/upload/pic/c20-20210729101859375.png"
                        alt="c20">
                    <img class="lazyload"
                        data-src="https://s3.eu-west-1.amazonaws.com/promo.blackview.hk/activity/oscal/img/c80.png"
                        alt="c20">
                    <img class="lazyload"
                        data-src="https://s3.eu-west-1.amazonaws.com/promo.blackview.hk/activity/oscal/img/s60.png"
                        alt="c20">
                    <img class="lazyload"
                        data-src="https://s3.eu-west-1.amazonaws.com/promo.blackview.hk/activity/oscal/img/c80.png"
                        alt="c20">
                </div>
                <div class="spesc-img-right">
                    <ul class="spesc-img-right-ul">
                        <li class="spesc-img-right-ul-li spesc-active" num='0'>
                            <div class="spescColor"
                                style="background: linear-gradient(90deg, #646060 16%, #373737 41%, #565656 73%, #363636 99%);">
                            </div>
                            <p class="spescColorName">black</p>
                        </li>
                        <li class="spesc-img-right-ul-li" num='1'>
                            <div class="spescColor"
                                style="background: linear-gradient(90deg, #5692A9 16%, #3C768C 41%, #5F99AF 73%, #468096 99%);">
                            </div>
                            <p class="spescColorName">black</p>
                        </li>
                        <li class="spesc-img-right-ul-li" num='2'>
                            <div class="spescColor"
                                style="background: linear-gradient(90deg, #66C2A0 16%, #56A787 41%, #77CEAF 73%, #56A787 99%);">
                            </div>
                            <p class="spescColorName">black</p>
                        </li>
                        <li class="spesc-img-right-ul-li" num='3'>
                            <div class="spescColor"
                                style="background: linear-gradient(90deg, #94B2F2 16%, #6F8CDA 41%, #93B0F2 73%, #7493E6 99%);">
                            </div>
                            <p class="spescColorName">black</p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

    </div>

</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script async
    src="https://d2kbvjszk9d5ln.cloudfront.net/yshop/upload/other/lazysizes.min-20201204070627489.js"></script>

<script>
    var active = $('.spesc-img-right .spesc-img-right-ul .spesc-active').find('.spescColor').attr('style')
    setColor(active)//切换颜色为当前对象添加伪类元素
    function setColor(color) {
        color = `<style>
    .spesc-img-right .spesc-img-right-ul .spesc-active .spescColor::after{
    position: absolute;
    content: '';
    left: 50%;
    border: 4px solid ${color.slice(35, 42)};
    top: 50%;
    transform: translate(-50%,-50%);
    width: 65px;
    height: 65px;
    border-radius: 50%;
    }
    </style>`
        $('.spesc-img-right .spesc-img-right-ul .spesc-active .spescColor').append(color)
    }

    $('.spesc-img-right .spesc-img-right-ul .spesc-img-right-ul-li').click(function (e) {
        $('.spesc-img-right .spesc-img-right-ul .spesc-active .spescColor').empty()//修复切换颜色之后伪类元素为清理的问题
        $(this).addClass('spesc-active').siblings().removeClass('spesc-active')
        setColor($(this).find('.spescColor').attr('style'))
        showImg($(this).attr('num'))
    })
    function showImg(index) {
        $('.spesc-img-left img').eq(index).addClass('image-active').siblings().removeClass('image-active')
        var ds = $('.spesc-img-left img.image-active')
        imgLoad(ds, function () {//切换颜色后，右侧切换对应图片
            ds.removeClass('on')//回调移除旋转图标
        })
    }
    function imgLoad(img, callback) {
        var timer = setInterval(function () {
            var flag = true
            console.log(img[0].complete);
            if (img[0].complete) {//判断图片是否加载
                callback();
                clearInterval(timer);
            } else if (flag) {//未加载时出现旋转图标
                flag = false
                img.addClass('on')
            }
        }, 200);
    }
    class MyPromise {
        constructor(exe) {
            this.status = undefined
            this.value = undefined
            this.successQueue = []
            this.failureQueue = []

            const resolve = value => {
                if (this.status != 'pending') return

                this.status = 'fulfilled'
                this.value = value

                let timer = setTimeout(() => {
                    clearTimeout(timer)
                    this.successQueue.forEach(item => {
                        item(this.value)
                    })
                }, 0);

            }
            const reject = value => {
                if (this.status != 'pending') return

                this.status = 'rejected'
                this.value = value

                let timer = setTimeout(() => {
                    this.failureQueue.forEach(item => {
                        item(this.value)
                    })
                }, 0);
            }
            try {
                exe(resolve, reject)
            } catch (error) {
                reject(error)
            }
        }
        then(successFn, failureFn) {
            typeof successFn !== 'function' ? successFn = result => result : null;
            return new Promise((resolve, reject) => {
                this.successQueue.push(() => {
                    try {
                        let result = successFn(this.value)
                        result instanceof MyPromise ? result.then(resolve, reject) : resolve(result)
                    } catch (error) {
                        reject(error)
                    }

                })
                typeof failureFn !== 'function' ? failureFn = reason => reject(reason) : null
                this.failureQueue.push(() => {
                    try {
                        let result = failureFn(this.value)
                        result instanceof MyPromise ? result.then(resolve, reject) : resolve(result)
                    } catch (error) {
                        reject (error)
                    }
                })
            })
        }
        catch(fn){
            return this.then(null,fn)
        }
    }
    Promise.myAll = (promises) => {
        return new Promise((resolve, reject) => {
            let count = 0
            let result = []
            let len = promises.length
            if (len === 0) {
                return ([])
            }
            promises.forEach((p, i) => {
                count++
                result[i] = item
                if (len === count) {
                    resolve(result)
                }
            })
        })
    }
    Promise.myAllSettled = promises => {
        let len = promises.length
        let count = 0
        let result = []
        return new Promise((resolve, reject) => {
            promises.forEach((p, i) => {
                Promise.resolve(p).then(res => {
                    result[i] = {
                        status: 'fulfilled',
                        value: res
                    }
                    count++
                    if (len === count) {
                        resolve(result)
                    }
                }, reason => {
                    result[i] = {
                        status: 'rejected',
                        value: reason
                    }
                    count++
                    if (len === count) {
                        resolve(result)
                    }
                })
            })
        })
    }
    Promise.myRace = promises => {
        return new Promise((resolve, reject) => {
            promises.forEach(p => {
                Promise.resolve(p).then(resolve).catch(reject)
            })
        })
    }
    Promise.myAny = promises => {
        return new Promise((resolve, reject) => {
            let len = promises.length
            let count = 0
            let result = []
            promises.forEach(item => {
                Promise.resolve(p).then(res => {
                    resolve(res)
                }, err => {
                    count++
                    result[count] = err
                    if (count === len) {
                        reject(result)
                    }
                })
            })
        })
    }
    Promise.prototype.myFinally = function (callback) {
        return this.then(result => {
            callback()
            return result
        }, reason => {
            callback()
            throw reason
        })
    }

    const myInstanceOf = function (obj, func) {
        if (obj === null || typeof obj !== 'object') {
            return false
        }

        let proto = Object.getPrototypeOf(obj)
        if (proto === null) {
            return false
        } else if (func.prototype === proto) {
            return true
        } else {
            return myInstanceOf(proto, func)
        }
    }
    function myflat(arr) {
        return arr.reduce((res, next) => {
            return res.concat(Array.isArray(next) ? myflat(next) : next)
        }, [])
    }
    Array.prototype.myReduce = function (fn, val) {
        let arr = Array.prototype.slice.call(this)

        let res, startIndex

        res = val ? res : arr[0]
        startIndex = val ? 0 : 1

        for (let index = startIndex; index < arr.length; index++) {
            res = fn.call(null, res, arr[index])
        }
        return res
    }
    console.log([1, 2, 3].myReduce((pre, next) => pre + next));
    function myNew(con, ...args) {
        let obj = Object.create(null)//创建了一个空对象
        Object.setPrototypeOf(obj, con.prototype)//空对象指向了构造函数的原型对象
        let result = con.apply(obj, args)//改变了上下文
        return result instanceof Object ? result : obj//判断返回值，基本对象则返回new创建的对象，引用对象则采用构造函数返回的对象
    }


</script>


</html>